<ion-header>
    <ion-navbar>
        <ion-title>
            {{chats.getConversationTitle(conversation)}}
            <last-activity prefix="Active" [chat]="conversation" text-small></last-activity>
        </ion-title>
        <ion-buttons end>
            <button (click)="editConversation()">
                <ion-icon name="settings"></ion-icon>
            </button>
        </ion-buttons>
    </ion-navbar>
</ion-header>

<ion-content id="chat" class="chat">
    <div class="messages">
        <div class="message" *ngFor="let m of conversation.messages" [ngClass]="{'me': m.author._id === auth.user._id}">
            <ion-avatar class="avatar">
                <mate-image [image]="m.author.pic"></mate-image>
            </ion-avatar>
            <span text-small *ngIf="conversation.members.length > 2 && m.author._id !== auth.user._id">
                {{m.author.name}}
            </span>
            <p>{{ m.msg }}</p>
            <span class="date">
                {{ m.added | date: 'short' }}
            </span>
        </div>
    </div>
    <div class="new-messages" text-center *ngIf="conversation.newMessages > 0">
        <button small round primary (click)="scrollToBottom()">
            New messages
        </button>
    </div>
    <div class="msg">
        <input type="text" placeholder="Message..." [(ngModel)]="message.msg" (keydown.enter)="sendMessage()">
        <button small (click)="sendMessage()" [disabled]="message.msg === ''">
            <ion-icon name="send"></ion-icon>
        </button>
    </div>
</ion-content>