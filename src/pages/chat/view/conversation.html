<ion-header>
    <ion-navbar>
        <ion-title>
            {{chats.getConversationTitle(conversation)}}
            <last-activity prefix="Active" [chat]="conversation" text-small></last-activity>
        </ion-title>
        <ion-buttons end>
            <button ion-button icon-only color="dark"
                    (click)="editConversation()">
                <ion-icon name="settings"></ion-icon>
            </button>
        </ion-buttons>
    </ion-navbar>
</ion-header>

<ion-content>
    <ion-list class="messages">
        <ion-item class="message"
                  *ngFor="let m of (conversation && conversation.messages)"
                  [ngClass]="{'me': m.author._id === auth.user._id}">
            <ion-avatar class="avatar">
                <mate-image [image]="m.author.pic"></mate-image>
            </ion-avatar>

            <span text-small *ngIf="conversation.members.length > 2 && m.author._id !== auth.user._id">
                {{m.author.name}}
            </span>
            <p>{{ m.msg }}</p>
            <time-ago text-small class="date" [time]="m.added"></time-ago>
        </ion-item>
    </ion-list>
    <div class="new-messages" text-center *ngIf="conversation && conversation.newMessages > 0">
        <button ion-button small round color="primary"
                (click)="scrollToBottom()">
            New messages
        </button>
    </div>
</ion-content>

<ion-footer>
    <ion-toolbar>
        <input type="text" placeholder="Message..." [(ngModel)]="message.msg" (keydown.enter)="sendMessage()">
        <button ion-button small icon-only
                [disabled]="message.msg === ''"
                (click)="sendMessage()">
            <ion-icon name="send"></ion-icon>
        </button>
    </ion-toolbar>
</ion-footer>

